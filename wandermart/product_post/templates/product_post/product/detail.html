{% extends "product_post/base.html" %}
{% load static %}

{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/product_detail.css' %}">

<div class="product-detail-container">

    <!-- Product Header -->
    <header class="product-header">
        <h1 class="product-title">{{ product.name }}</h1>
        <p class="product-meta">Listed: {{ product.publish }} by {{ product.store }}</p>
    </header>

    <!-- Product Description -->
    <section class="product-description">
        <p>{{ product.description }}</p>
    </section>

    <!-- Call to Action -->
    <div class="buy-section">
        <a class="btn-buy" href="{% url 'order:place_order' product.id %}">Buy Now</a>
    </div>

    <!-- Review Summary -->
    <section class="reviews-summary">
        {% with reviews.count as total_reviews %}
            <h2>Reviews ({{ total_reviews }})</h2>
        {% endwith %}
    </section>

    <!-- Reviews List -->
    <section class="reviews-list">
        {% for review in reviews %}
        <div class="review">
            <div class="review-header">
                <strong>{{ review.user }}</strong>
                <span class="review-date">{{ review.dateadded }}</span>
            </div>
            <p class="review-rating">
                {% for i in "12345"|slice:":review.rating"|make_list %}
                    <span class="star-rating">â˜…</span>
                {% endfor %}
                ({{ review.rating }} / 5)
            </p>
            <p class="review-text">{{ review.text }}</p>
        </div>
        {% empty %}
        <p class="no-reviews">There are no reviews yet.</p>
        {% endfor %}
    </section>

    <!-- Auth Status -->
    <div class="auth-status">
        {% if user.is_authenticated %}
            <div class="auth-box">
                <p>ðŸ‘‹ Welcome, <strong>{{ user.username }}</strong>!</p>
                <a href="{% url 'product_post:logout' %}" class="btn-logout">Logout</a>
            </div>
        {% else %}
            <div class="auth-box">
                <p>Ready to join the conversation?</p>
                <a href="{% url 'product_post:loginformpage' %}" class="btn-login">Login & Share Your Thoughts</a>
            </div>
        {% endif %}
    </div>

    <!-- Add Review -->
    {% if user.is_authenticated %}
        <section class="add-review-form">
            {% if new_review %}
                <div class="review-success">
                    <h3>ðŸŽ‰ Your review has been added!</h3>
                </div>

                <!-- Confetti script -->
                <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
                <script>
                    window.addEventListener("DOMContentLoaded", function () {
                        confetti({
                            particleCount: 150,
                            spread: 70,
                            origin: { y: 0.6 }
                        });
                    });
                </script>
            {% else %}
                <h3>Share Your Thoughts</h3>
                <form method="post" class="review-form">
                    {% csrf_token %}
                    {{ review_form.as_p }}
                    <input type="submit" class="btn-submit" value="Submit Review">
                </form>
            {% endif %}
        </section>
    {% endif %}
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
function triggerCelebration() {
    confetti({
        particleCount: 150,
        spread: 70,
        origin: { y: 0.6 }
    });
}
</script>
{% endblock %}
